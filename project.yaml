version: '3.0'

expectations:

  population_size: 100000

actions:

  ## # # # # # # # # # # # # # # # # # # # 
  ## DO NOT EDIT project.yaml DIRECTLY 
  ## This file is created by create_project.R 
  ## Edit and run create_project.R to update the project.yaml 
  ## # # # # # # # # # # # # # # # # # # # 
  ## # # # # # # # # # # # # # # # # # # # 
  ## Metadata for study design 
  ## # # # # # # # # # # # # # # # # # # # 

  design:
    run: r:latest analysis/00_design.R
    outputs:
      moderately_sensitive:
        dates_json: analysis/lib/dates.json
        dates_rds: analysis/lib/dates.rds

  ## # # # # # # # # # # # # # # # # # # # 
  ## Study definition 
  ## # # # # # # # # # # # # # # # # # # # 

  study_definition:
    run: cohortextractor:latest generate_cohort --study-definition study_definition
    needs:
    - design
    outputs:
      highly_sensitive:
        cohort: output/input.csv

  ## # # # # # # # # # # # # # # # # # # # 
  ## Process the data 
  ## # # # # # # # # # # # # # # # # # # # 

  process_data:
    run: r:latest analysis/01_data_process.R
    needs:
    - study_definition
    outputs:
      highly_sensitive:
        data: output/data/data_processed_*.rds
      moderately_sensitive:
        dates: output/data/elig_dates_tibble.rds
