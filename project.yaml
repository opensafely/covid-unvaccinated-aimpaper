version: '3.0'

expectations:

  population_size: 100000

actions:

  ## # # # # # # # # # # # # # # # # # # # 
  ## DO NOT EDIT project.yaml DIRECTLY 
  ## This file is created by create_project.R 
  ## Edit and run create_project.R to update the project.yaml 
  ## # # # # # # # # # # # # # # # # # # # 
  ## # # # # # # # # # # # # # # # # # # # 
  ## Metadata for study design 
  ## # # # # # # # # # # # # # # # # # # # 

  design:
    run: r:latest analysis/00_design.R
    outputs:
      moderately_sensitive:
        dates: analysis/lib/dates.json

  ## # # # # # # # # # # # # # # # # # # # 
  ## Study definition 
  ## # # # # # # # # # # # # # # # # # # # 

  study_definition:
    run: cohortextractor:latest generate_cohort --study-definition study_definition
    needs:
    - design
    outputs:
      highly_sensitive:
        cohort: output/input.csv

  ## # # # # # # # # # # # # # # # # # # # 
  ## Process the data 
  ## # # # # # # # # # # # # # # # # # # # 

  process_data:
    run: r:latest analysis/01_data_process.R
    needs:
    - study_definition
    outputs:
      highly_sensitive:
        data: output/data/data_processed_*.rds

  ## # # # # # # # # # # # # # # # # # # # 
  ## Summary tables for each elig_group 
  ## # # # # # # # # # # # # # # # # # # # 

  summary_tables_02:
    run: r:latest analysis/02_summary_tables.R 02
    needs:
    - process_data
    outputs:
      moderately_sensitive:
        data: output/data/summary_table_02.rds

  summary_tables_09:
    run: r:latest analysis/02_summary_tables.R 09
    needs:
    - process_data
    outputs:
      moderately_sensitive:
        data: output/data/summary_table_09.rds

  summary_tables_11:
    run: r:latest analysis/02_summary_tables.R 11
    needs:
    - process_data
    outputs:
      moderately_sensitive:
        data: output/data/summary_table_11.rds

