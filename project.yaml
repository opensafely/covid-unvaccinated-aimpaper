version: '3.0'

expectations:

  population_size: 100000

actions:

  ## # # # # # # # # # # # # # # # # # # # 
  ## DO NOT EDIT project.yaml DIRECTLY 
  ## This file is created by create_project.R 
  ## Edit and run create_project.R to update the project.yaml 
  ## # # # # # # # # # # # # # # # # # # # 
  ## # # # # # # # # # # # # # # # # # # # 
  ## Metadata for study design 
  ## # # # # # # # # # # # # # # # # # # # 

  design:
    run: r:latest analysis/00_design.R
    outputs:
      moderately_sensitive:
        dates: analysis/lib/dates.json

  ## # # # # # # # # # # # # # # # # # # # 
  ## Study definition 
  ## # # # # # # # # # # # # # # # # # # # 

  study_definition:
    run: cohortextractor:latest generate_cohort --study-definition study_definition
    needs:
    - design
    outputs:
      highly_sensitive:
        cohort: output/input.csv

  ## # # # # # # # # # # # # # # # # # # # 
  ## Process the data 
  ## # # # # # # # # # # # # # # # # # # # 

  process_data:
    run: r:latest analysis/01_data_process.R
    needs:
    - study_definition
    outputs:
      highly_sensitive:
        data: output/data/data_processed_*.rds

  ## # # # # # # # # # # # # # # # # # # # 
  ## Summary tables for each jcvi_group 
  ## # # # # # # # # # # # # # # # # # # # 

  summary_tables_02:
    run: r:latest analysis/02_summary_tables.R 02
    needs:
    - process_data
    outputs:
      moderately_sensitive:
        table: output/tables/summary_table_02.rds

  summary_tables_09:
    run: r:latest analysis/02_summary_tables.R 09
    needs:
    - process_data
    outputs:
      moderately_sensitive:
        table: output/tables/summary_table_09.rds

  summary_tables_11:
    run: r:latest analysis/02_summary_tables.R 11
    needs:
    - process_data
    outputs:
      moderately_sensitive:
        table: output/tables/summary_table_11.rds

  ## # # # # # # # # # # # # # # # # # # # 
  ## Models for each jcvi_group and model_type 
  ## # # # # # # # # # # # # # # # # # # # 

  model_02_unadj:
    run: r:latest analysis/03_model.R 02 unadj
    needs:
    - process_data
    outputs:
      moderately_sensitive:
        model: output/models/model_02_unadj_*.rds
        table: output/tables/table_02_unadj.rds

  model_02_padj:
    run: r:latest analysis/03_model.R 02 padj
    needs:
    - process_data
    outputs:
      moderately_sensitive:
        model: output/models/model_02_padj_*.rds
        table: output/tables/table_02_padj.rds

  model_02_fadj:
    run: r:latest analysis/03_model.R 02 fadj
    needs:
    - process_data
    outputs:
      moderately_sensitive:
        model: output/models/model_02_fadj_*.rds
        table: output/tables/table_02_fadj.rds

  model_09_unadj:
    run: r:latest analysis/03_model.R 09 unadj
    needs:
    - process_data
    outputs:
      moderately_sensitive:
        model: output/models/model_09_unadj_*.rds
        table: output/tables/table_09_unadj.rds

  model_09_padj:
    run: r:latest analysis/03_model.R 09 padj
    needs:
    - process_data
    outputs:
      moderately_sensitive:
        model: output/models/model_09_padj_*.rds
        table: output/tables/table_09_padj.rds

  model_09_fadj:
    run: r:latest analysis/03_model.R 09 fadj
    needs:
    - process_data
    outputs:
      moderately_sensitive:
        model: output/models/model_09_fadj_*.rds
        table: output/tables/table_09_fadj.rds

  model_11_unadj:
    run: r:latest analysis/03_model.R 11 unadj
    needs:
    - process_data
    outputs:
      moderately_sensitive:
        model: output/models/model_11_unadj_*.rds
        table: output/tables/table_11_unadj.rds

  model_11_padj:
    run: r:latest analysis/03_model.R 11 padj
    needs:
    - process_data
    outputs:
      moderately_sensitive:
        model: output/models/model_11_padj_*.rds
        table: output/tables/table_11_padj.rds

  model_11_fadj:
    run: r:latest analysis/03_model.R 11 fadj
    needs:
    - process_data
    outputs:
      moderately_sensitive:
        model: output/models/model_11_fadj_*.rds
        table: output/tables/table_11_fadj.rds

